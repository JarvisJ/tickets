<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head><title>Tickets!</title></head>

<script src="js/d3.js" type="text/javascript" ></script>
<style>

.background {                                                      
  fill: none;
  pointer-events: all;
}

#states {
  fill: #aaa;
  stroke: none;
  stroke-width: 0px;
}

/*#states path:hover {
  fill: #aaa;
  stroke: none;
  stroke-width: 0px;
}*/


#counties path {
  stroke: #000;
  fill: transparent;
}

#townships path {
  stroke: #000;
  fill: transparent;
}

</style>
<body>
<h2><span>Year over Year % Change</span>-- Dealer Purchases (yellow ~100%, green >100%, red <100%)</h2>
<div id="hoverDiv" style="width:400px;height:650px;overflow:auto;border-style:solid;border-width:1px;display:none" ></div>
<div id="zipHoverDiv" style="border-style:solid;border-width:1px;display:none" ></div>
<table>
    <tr>
        <td>Select a measurement</td>
        <td><select  id="measurementPulldown" ></select> </td>
        <td><a  id="showCustomers" >Show Customers</a></td>
        <td><a  id="hideCustomers" >Hide Customers</a></td>
        <td><a id="cartwright"  >Only Jerry Cartwright</a></td>
        <td><a id="onlyReg2"  >Only Region 02</a></td>   
        <td><a id="fullZoomOut"  >&nbsp;&nbsp;Full Zoom Out</a></td>        
    </tr>
    <tr>
        <td>Show Townships and Cities<input type="radio" name="map" checked id="radioTownships" value="Townships and Cities" onclick="radioSelect();" /></td>
        <td>Show Zip Codes<input type="radio" name="map" id="radioZips" value="Zip Codes" onclick="radioSelect();" />    </td>
    </tr>
</table>
<script type="text/javascript" >

var width = 960,
    height = 1000,
    centered;

var arenaArray = [];
var arenaData;


var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("id","mainSVG");

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height);    

var arena = svg.append("g")
  .attr("transform", "translate(" + width / 8 + "," + height / 8 + ")")
  .append("g")
    .attr("id", "arena");

    ;

     

var rectangles = svg.append("svg:g")
    .attr("transform", "translate(" + width / 8 + "," + height / 8 + ")")
  .append("g")
    .attr("id", "rectangles");

var circles = svg.append("svg:g")
    .attr("transform", "translate(" + width / 8 + "," + height / 8 + ")")
  .append("g")
    .attr("id", "circles");    
    
var measurementPulldown = d3.select("#measurementPulldown")     
var ticketData;

var crislerFilename = "json/crisler.json";
var consecoFilename = "json/concesco.json";
var arenaFile = crislerFilename;

var consecoRowFunc = function(d) { 
              		  if(arenaData[d.vi].centroid[1] > arenaData["bbox"].centroid[1]) {
              		  	  return arenaData[d.vi].bbox.y + ((arenaData[d.vi].bbox.height/25)*(+d.rd));
              		  }							
              		  else {
              		  	  return arenaData[d.vi].bbox.y + arenaData[d.vi].bbox.height - ((arenaData[d.vi].bbox.height/25)*(+d.rd));
              		  }
						
					};

var crislerRowFunc = function(d) { 
	var isLower = d.va.substring(0,5) == "Lower";
	var topRow = isLower? 20 : 22;
	var secRow = isLower? +d.rd : +d.rd-21;
              		  if(arenaData[d.vi].centroid[1] > arenaData["bbox"].centroid[1]) {
              		  	  return arenaData[d.vi].bbox.y + ((arenaData[d.vi].bbox.height/topRow)*(secRow));
              		  }							
              		  else {
              		  	  return arenaData[d.vi].bbox.y + arenaData[d.vi].bbox.height - ((arenaData[d.vi].bbox.height/topRow)*(secRow));
              		  }
						
					};					

var rowFunc = arenaFile == crislerFilename ? crislerRowFunc: consecoRowFunc; 


 d3.json(arenaFile,
    function(json) {
        arenaData = json;
       // d3.json("json/sessionone-02-20-2014-10-24-00-00-00.json", function(json2) {
        		  d3.json("json/michiganmsu4351789-02-20-2014-10-00-00-00-00.json",function(json2) {
        		ticketData = json2.eventTicketListing.eventTicket;  
        		  
			  for( var key in arenaData ) {
				  arenaData[key].secID = key;
				  arenaData[key].ticketArray = [];
				  arenaArray.push(arenaData[key]); 
			  }                                                                                        
        
			  for( var i = 0; i < ticketData.length; i++ ) {
			  	  if(ticketData[i].vi) {
			  	  	  arenaData[ticketData[i].vi].ticketArray.push( ticketData[i]);
			  	  }
			  }
        
          arena.selectAll("path")
              .data(arenaArray)
            .enter().append("path")
            .attr("d", function(d) { 
            			return d.p;
            })
            .style("fill",function(d) { return "white" })
            .attr("stroke","black")
            .attr("stroke-width","2px")
            .attr("transform", "scale(.2)")
            .style("visibility", function(d) { return d.secID=="bbox"? "hidden":"" })
             // .on("click", click)
              .on("mouseover", function(d){
              		d3.select(this).style("fill","yellow");
              //d3.selectAll("[chv^='chv_"+d.region.substring(4,6)+"_']").attr("class",getCountyDistrictColor);
              })  
              .on("mouseout",function(d){
              		  d3.select(this).style("fill","white");
                //d3.selectAll("[chv^='chv_"+d.region.substring(4,6)+"_']").attr("class",getCountyColor);
                })
                .each(function(d) {
                    var myBar = d3.select(this);
                    if (arenaData[d.secID]) {
                        arenaData[d.secID].d3Bar = myBar;
                        
                        var bbox = myBar[0][0].getBBox();
                        arenaData[d.secID].bbox = bbox;
                        arenaData[d.secID].centroid = [bbox.x+bbox.width/2,bbox.y+bbox.height/2];
                    }
                });

        rectangles.selectAll("rect")
              .data(arenaArray)
            .enter().append("rect")        
            .attr("x", function(d) { 
            			return d.bbox.x;
            })
            .attr("width", function(d) { 
            			return d.bbox.width;
            })  
            .attr("y", function(d) { 
            			return d.bbox.y;
            })
            .attr("height", function(d) { 
            			return d.bbox.height;
            })             
            .style("fill",function(d) { return "transparent" })
            .attr("stroke","orange")
            .style("stroke-width", "5px")             
            .attr("transform", "scale(.2)")    ;  
            
          circles.selectAll("circle")
              .data(ticketData)
            .enter().append("circle")
            .attr("r", function(d) { 
            			return "20px";
            })
            .style("fill",function(d) { return "green" })
            .attr("stroke","black")
            .style("stroke-width", "0.3px")             
            .attr("transform", "scale(.2)")
             // .on("click", click)
              .on("mouseover", function(d){
              		d3.select(this).style("fill","yellow");
              //d3.selectAll("[chv^='chv_"+d.region.substring(4,6)+"_']").attr("class",getCountyDistrictColor);
              })  
              .on("mouseout",function(d){
              		  d3.select(this).style("fill","green");
                //d3.selectAll("[chv^='chv_"+d.region.substring(4,6)+"_']").attr("class",getCountyColor);
                })
              .attr("cx", function(d) { 
              		  var seatAry = d.se.split(",");
              		  var seatNum = 5.5;
              		  if(seatAry.length > 0 && !isNaN(seatAry[0])) {
              		  	  seatNum = seatAry[0];
              		  }
              return arenaData[d.vi].bbox.x + ((arenaData[d.vi].bbox.width/16)*seatNum); 
              })
					.attr("cy", rowFunc)        ;              
              
		  circles.append("circle")
		  	.attr("r", "10px") 
		  	.attr("cx", arenaData["bbox"].centroid[0])
		  	.attr("cy", arenaData["bbox"].centroid[1])
		  	.style("fill","blue")
		  	.attr("transform","scale(.2)");
        
            
              
        });
});  
 
      
</script>
</body>
</html>